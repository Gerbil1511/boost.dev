{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{% block title %}Boost.dev - Accelerate Your Development Journey{% endblock %}</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        
        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>
        {% tailwind_css %}
        
        <!-- Custom CSS -->
        <link rel="stylesheet" href="{% static 'css/main.css' %}">
        
        <!-- FontAwesome -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    </head>

    <body>

       <!-- Level Up Notification -->
        <div id="level-up-notification" class="fixed inset-0 flex items-center justify-center z-50 hidden">
            <div class="absolute inset-0 bg-black opacity-50"></div>
            <div class="bg-gray-800 rounded-lg p-8 max-w-md mx-auto relative z-10 border-4 border-yellow-400 text-center">
                <div class="mb-4 relative">
                    <i class="fas fa-level-up-alt text-yellow-400 text-5xl absolute -top-6 -right-6 transform rotate-12 animate-pulse"></i>
                    <i class="fas fa-level-up-alt text-yellow-400 text-6xl mb-2 animate-bounce"></i>
                </div>
                <h2 class="text-3xl font-bold text-white mb-2">Level Up!</h2>
                <p id="level-up-message" class="text-gray-300 mb-6 text-xl">Congratulations! You've reached <span class="text-yellow-400 font-bold">Level <span id="new-level">2</span></span>!</p>
                <div class="flex justify-center">
                    <button id="close-notification" class="bg-indigo-500 hover:bg-indigo-600 text-white px-5 py-3 rounded shadow transition-all">
                        Continue
                    </button>
                </div>
            </div>
        </div>
      
        <header class="{% block header_class %}default-header-class{% endblock %}">
            <a href="/" class="logo">
              <span class="logo-icon">B</span>
              Boost.dev
            </a>
          
            {% block auth_nav %}
            <!-- Default Auth Nav (if any) -->
            {% endblock %}
         </header>

        
        <!-- Messages Section -->
        {% if messages %}
        <div class="fixed top-16 left-1/2 transform -translate-x-1/2 z-40 w-full max-w-md px-4">
            {% for message in messages %}
            <div class="mb-4 p-4 rounded-lg shadow-md border
                {% if message.tags == 'success' %}
                  bg-green-100 text-green-800 border-green-300
                {% elif message.tags == 'error' %}
                  bg-red-100 text-red-800 border-red-300
                {% elif message.tags == 'warning' %}
                  bg-yellow-100 text-yellow-800 border-yellow-300
                {% elif message.tags == 'info' %}
                  bg-blue-100 text-blue-800 border-blue-300
                {% else %}
                  bg-gray-100 text-gray-800 border-gray-300
                {% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Main Content Section -->
        <main class="px-4 pt-20 sm:pt-24">
            {% block content %}
            <!-- Content from child templates will be inserted here -->
            {% endblock %}
        </main>
        
        <!-- Achievement Toast Notification - Initially hidden with inline style -->
        <div id="achievement-toast" class="fixed right-5 bottom-5 bg-gray-800 border-2 border-yellow-400 rounded-lg shadow-lg p-4 max-w-sm transform transition-transform duration-500 z-50" style="transform: translateY(150%);">
          <div class="flex items-start gap-3">
            <div class="bg-yellow-400 rounded-full p-3 flex-shrink-0">
              <i id="achievement-icon" class="fas fa-trophy text-gray-800 text-xl animate-pulse"></i>
            </div>
            <div>
              <h3 class="text-white font-bold text-lg mb-1">Achievement Unlocked!</h3>
              <p id="achievement-name" class="text-yellow-400 font-medium mb-1">Achievement Name</p>
              <p id="achievement-desc" class="text-gray-300 text-sm">Achievement description goes here</p>
            </div>
            <button id="close-achievement-toast" class="text-gray-400 hover:text-white ml-auto">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        
        <!-- JavaScript for Level Up and Achievement Notifications -->
        <script>
            // Immediately hide the achievement toast on page load
            document.getElementById('achievement-toast').style.transform = 'translateY(150%)';
            
            document.addEventListener('DOMContentLoaded', function() {
                // Check for level-up flag from context processor
                {% if level_up_flag %}
                    document.getElementById('new-level').textContent = "{{ level_up_flag }}";
                    document.getElementById('level-up-notification').classList.remove('hidden');
                {% endif %}
                
                // Level up notification from Django messages
                const messages = document.querySelectorAll('.fixed.top-16 .mb-4');
                messages.forEach(function(message) {
                    if (message.textContent.includes('Congratulations! You\'ve reached Level')) {
                        // Extract the level number from the message
                        const levelMatch = message.textContent.match(/Level (\d+)/);
                        if (levelMatch && levelMatch[1]) {
                            // Show level up notification
                            const levelNumber = levelMatch[1];
                            document.getElementById('new-level').textContent = levelNumber;
                            document.getElementById('level-up-notification').classList.remove('hidden');
                            
                            // Hide the django message
                            message.style.display = 'none';
                        }
                    }
                    
                    // Achievement notification
                    if (message.textContent.includes('Achievement Unlocked:')) {
                      // Extract achievement data
                      const regex = /Achievement Unlocked: (.*?) - (.*)/;
                      const match = message.textContent.match(regex);
                      
                      if (match && match.length >= 3) {
                        const achievementName = match[1];
                        const achievementDesc = match[2];
                        
                        // Show achievement toast
                        showAchievementToast(achievementName, achievementDesc);
                        
                        // Hide the django message
                        message.style.display = 'none';
                      }
                    }
                });
                
                // Close notification on button click
                document.getElementById('close-notification').addEventListener('click', function() {
                    document.getElementById('level-up-notification').classList.add('hidden');
                });
                
                // Close achievement toast on button click
                document.getElementById('close-achievement-toast').addEventListener('click', function() {
                    document.getElementById('achievement-toast').style.transform = 'translateY(150%)';
                });
            });
            
            function showAchievementToast(name, description, icon) {
              // Set achievement content
              document.getElementById('achievement-name').textContent = name;
              document.getElementById('achievement-desc').textContent = description;
              
              // Set icon if provided
              if (icon) {
                document.getElementById('achievement-icon').className = `fas fa-${icon} text-gray-800 text-xl`;
              }
              
              // Show the toast
              const toast = document.getElementById('achievement-toast');
              toast.style.transform = 'translateY(0)';
              
              // Hide after 5 seconds
              setTimeout(() => {
                toast.style.transform = 'translateY(150%)';
              }, 5000);
            }
        </script>
    </body>
</html>